<!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<title>toDoo</title>
</head>
<body>
	<h1>ToDo List</h1>
	<p>Taks eingeben:</p>

	<button id="listOpen" type="button">show open items</button>
	<button id="listClosed" type="button">show closed items</button>
	<button id="listAll" type="button">show all items</button>

	<form action="/create" method="POST" name="myForm" id="form">
	    <label for="name">Enter task: </label>
	    <input type="text" name="pendenz" value="Pendenz">
	    <input type="submit" value="Add" id="submit">
	</form>

	<p id="ausgabe"></p>
	<ul id="list">
		<!-- hier kommen die Tasks hin -->
	</ul>


<script type="text/javascript">
    $(document).ready(function(){


        // wenn Checkbox geändert wird
        function checkboxChanged() {
            console.log("Checkbox changed");

            //if ($(this).prop('checked') == 'true') {

            if ($(this)[0].hasAttribute('checked') == true) {
                console.log('status ist checked');
                var formData = {
                'id'      : $(this).attr('id'),
                'status' : 'unchecked' 
                }
            } else {
                console.log('status ist unchecked');
                var formData = {
                'id'      : $(this).attr('id'),
                'status'  : 'checked'
                }
            }; 
            $.ajax({
                type: 'POST',
                url:  'updateItem',
                data: formData  
            })
            .done(listItems)
        }

        // Liste erstellen
        function listItems(data, callback){
            var json = JSON.parse(data);
            
                $('#list li').remove();         // Liste löschen
                json.forEach(function(item){    // Liste neu aufbauen
                    if ($(item).prop('status') == 'checked') {
                        $("#list").append('<li><input type="checkbox" id='+item.taskid+' checked><label>'+item.task+'</label></li>');
                    }
                    else {
                        $("#list").append('<li><input type="checkbox" id='+item.taskid+'><label>'+item.task+'</label></li>');    
                    }
                });
                $("input:checkbox").on('click', checkboxChanged); // EventHandler
        }
    	  
        // Neuer Task an Server senden und Liste aktualisieren d.h. neu aufbauen
        $("#form").submit(function(event){
        	var formData = {'pendenz' : $('input[name=pendenz]').val()};
        	$.ajax({
                type: 'POST',
                url:  'create',
                data: formData
            })
            .done(listItems)
        	event.preventDefault();
        });
        
        // Filter: alle Task anzeigen ( = Filter löschen)
        $("#listAll").click(function(){
            $.ajax({
                type: 'GET',
                url: 'listTasks'  
            })
            .done(listItems)
    	});

        // Filter: nur geschlossene Tasks anzeigen
        $("#listClosed").click(function(){
            $.ajax({
                type: 'GET',
                url: 'listClosedTasks'
            })
            .done(listItems)   
    	});

        // Filter: nur offene Tasks anzeigen
    	$("#listOpen").click(function(){
            $.ajax({
                type: 'GET',
                url: 'listOpenTasks',
            })
            .done(listItems)   
        });


	});
</script>


</body>
</html>


